# 6.6 Troubleshooting
## Home Work
###   ***Task 1***
+ остановка текущей операции
```bash
    db.currentOp()
    db.killOp()
```  
+ предложение по предотвращению долгих операций:
        необходимо постороить/перестроить соответствующий индекс
###   ***Task 2***
+ Возможно имеют место быть ключи истекающие в одно и то же время.
### ***Task 3***
+ Возможной причиной может быть увеличение нагрузки на БД, сбои сети. 
+ Возможные меры решения:
   1. Увеличить значение параметров : connect_timeout, interactive_timeout, wait_timeout;
   2. Добавить ресурсов на машине;
   3. Создать индексы для оптимизации  и ускорения запросов;
   4. Увеличивать net_read_timeout;
   5. расширить максимальное число соединений (max_connections). 
### ***Task 4***
+ Возможно имеет место потребность в использовании больших страниц, поэтому возникает недостаток оперативной памяти, в результате ОС завершает процессы утилизирующие память, чтобы предотвратить падение всей системы.
Для предотвращения сбоев , необходимо увеличить объем ОЗУ или выставить ограничение в настройках PostgreSQL на использование ресурсов хоста, 
чтобы исключить потребление всех ресурсов на машине. Пример решения:

```bash
    $ head -1 $PGDATA/postmaster.pid
    4170
    $ pmap 4170 | awk '/rw-s/ && /zero/ {print $2}'
    6490428К
    $ grep ^Hugepagesize /proc/meminfo
    Hugepagesize: 2048 kB
```
```bash
    sysctl -w vm.nr_hugepages=3170
```
